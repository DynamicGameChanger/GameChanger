<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Game Controller</title>
  <!-- <script src='/socket.io/socket.io.js'></script>
  <script src="http://code.jquery.com/jquery-1.12.0.min.js"></script> -->
  <link href="controller/css/bootstrap.css" rel="stylesheet">
  <!--external css-->
  <!-- <link rel="stylesheet" type="text/css" href="assets/css/zabuto_calendar.css"> -->
  <link rel="stylesheet" type="text/css" href="controller/js/gritter/css/jquery.gritter.css" />
  <link rel="stylesheet" href="controller/css/style.css">
  <link href="controller/css/graph.css" rel="stylesheet" type="text/css" />
  <link href="controller/font-awesome/css/font-awesome.css" rel="stylesheet" />
</head>

<body>
  <section id="container" >
    <header class="header black-bg">
            <div class="sidebar-toggle-box">
                <div class="fa fa-bars"></div>
            </div>
          <a href="index.html" class="logo"><b>VICISSITUTOR</b></a>
          <div class="top-menu">
            <ul class="nav pull-right top-menu">

                  <li><a class="logout" href="login.html">Logout</a></li>
            </ul>
          </div>
      </header>
    <!--header end-->


    <!-- modal info when Game Change clicked -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Vicissitutor</h4>
          </div>
          <div class="modal-body">
            <h1>Select a game to control.</h1>
              <form>
                <select id='gameChoice' name="game">
                  <option value="snake">Snake</option>
                  <option value="marble">Marble</option>
                  <option value="tron">Tron</option>
                  <option value="space">Space Invader</option>
                </select>
               <h2>Game Descriptions</h2>
               <p><strong>Snake Game: </strong><br>Snake is a game where the player maneuvers a line which grows in length, with the line itself being a primary obstacle.</p>
               <p><strong>Marble Game: </strong><br>The objective of the marble game is to get the ball into the hole.</p>
               <p><strong>Tron: </strong><br>Tron</p>
               <p><strong>Space Invaders: </strong><br>Shoot things.</p>

            <div class="modal-footer">
              <button id='change' type="button" class="btn btn-primary">Change Game</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
            <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js">
              $('#change').submit(function(e) {
                e.preventDefault();
                localStorage.setItem('gameChoice', $('#gameChoice').val());
                window.location = '/controller'
              })
            </script> -->
            </form>
          </div>
        </div>
      </div>
    </div>

    <aside>
        <div id="sidebar"  class="nav-collapse ">
            <ul class="sidebar-menu" id="nav-accordion">

                <p class="centered"><a href="profile.html"><img src="logo.jpg" class="img" width="60"></a></p>
                <h5 class="centered">Admin</h5>

                <li class="mt">
                  <a href="javascript:;" data-toggle="modal" data-target="#myModal">
                    <i class="fa fa-desktop"></i>
                    <span>Change Game</span>
                  </a>
                </li>

                <li class="sub-menu">
                    <a href="javascript:;" >
                        <i class="fa fa-copy"></i>
                        <span>Copy Client URL</span>
                    </a>
                </li>

            </ul>
        </div>
    </aside>

    <section id="main-content">
        <section class="wrapper">

            <div class="row mt">
              <div class="col-md-6 col-sm-6 mb">
                <div class="white-panel pn">
                  <div class="white-header">
                    <h5>Performance</h5>
                  </div>
                <!-- <span><img src='logo.jpg'style='width:80%; height:80%; margin: 0 auto'/></span> -->
                  <div class='module' id='dataDisplay'>
                    <div id="graph"></div>
                    <div id='graphOptions'></div>
                  </div>

                </div>
              </div>

              <div class="col-md-6 col-sm-6 mb">
                <div class="white-panel pn">
                  <div class="white-header">
                    <h5>Clients View</h5>
                  </div>

                  <div class='module' id='screenCast'></div>

                </div>
              </div><!-- /col-md-4 -->

            <div class="col-md-12 mb">
              <div id='sheup' class="white-panel pn">
                <div class="white-header">
                  <h5>Controllers</h5>
                </div>

                <div class='module' id='controls'>

                  <!-- <h1 id='greeting'>Hello UserName</h1>
                  <p id='instructions'>Copy client URL below; then give it to your client.</p>
                  <p id="player"> <strong>Client URL:</strong></p>
                  <p id='url'></p>
                  <button id='button'>Copy URL</button> -->

                  <center>
                    <table id='controllers'>
                      <tr width='100%'>
                      </tr>
                    </table>
                  </center>
                </div>

              </div>
            </div>
          </div><!-- /row -->

          <footer class="site-footer">
              <div class="text-center">
                  Vicissitutor
                  <a href="index.html#" class="go-top">
                      <i class="fa fa-angle-up"></i>
                  </a>
              </div>
          </footer>

        </section>
    </section>
</section>

  <script src='/socket.io/socket.io.js'></script>
  <!-- <script src="http://code.jquery.com/jquery-1.12.0.min.js"></script> -->
  <script src="controller/js/jquery.js"></script>
    <!-- <script src="controller/js/jquery-1.8.3.min.js"></script> -->
    <script src="controller/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="controller/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="controller/js/jquery.scrollTo.min.js"></script>
    <script src="controller/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="controller/js/jquery.sparkline.js"></script>
    <script src="controller/js/common-scripts.js"></script>
    <script type="text/javascript" src="controller/js/gritter/js/jquery.gritter.js"></script>
    <script type="text/javascript" src="controller/js/gritter-conf.js"></script>

	<script type="text/javascript">
      $(document).ready(function () {
        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Getting Started',
            // (string | mandatory) the text inside the notification
            text: '1. Copy URL from the left nav bar and send to client. <br>2. To change games click on "Change Game" in the nav bar. ',
            // (string | optional) the image to display on the left
            image: 'logo.jpg',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: true,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });
      return false;
      });
	</script>
  <script>
  var qs = '/' + window.location.search.slice(window.location.search.indexOf('?') + 4);

    var socket = io(qs);

    var url = 'localhost:3000/' + localStorage.getItem('gameChoice') + '?id=' + window.location.search.slice(window.location.search.indexOf('?') + 4);
    $('#url').text(url);
    $('#button').click(function(event) {
        var range = document.createRange();
        var selection = window.getSelection();
        range.selectNodeContents(document.getElementById('url'));
        selection.removeAllRanges();
        selection.addRange(range);
        document.execCommand('copy');
        selection.removeAllRanges();
      });

    var ctrlObj = {};
    var graphCounter = 0;

    function properSpacing(word) {
      var re = /[A-Z]/g,
        changeLetter = word.match(re);
      if (changeLetter) {
        var wordArr = word.replace(changeLetter, ' ' + changeLetter).split(' ');
      } else {
        var wordArr = [word];
      }
      var first = wordArr[0][0].toUpperCase() + wordArr[0].slice(1);
      wordArr[0] = first;
      return wordArr.join(' ')

    }

    var currentGame;
    socket.on('obj', function(val) {
      if (currentGame !== val.gameName) {
        $('#graphOptions').empty()
        $('td').remove();
        ctrlObj = val.controllers;
        currentGame = val.gameName;
        var numOfVars = Object.keys(ctrlObj).length;
        for (var key in ctrlObj) {
          if (ctrlObj[key].value || ctrlObj[key].value === 0) {
            localStorage.setItem(ctrlObj[key], ctrlObj[key].value)
          }
          if (ctrlObj[key].type === 'range') {
            $('#controllers tr').append('<td width="' + 100 / numOfVars + '%"><h3>' + properSpacing(key) + '</h3><input type="text" value="' + ctrlObj[key].value + '" class="dial" id="' + key +
              '" oninput="function(){console.log("hi")}" data-step="' + ctrlObj[
                key].step + '" data-min="' + ctrlObj[key].min + '" data-max="' + ctrlObj[key].max + '" data-width="100" data-thickness="0.4" padding="20px"/></td>');
          } // if (ctrlObj[key].type==='button' ) $( '#controls').append( '<button id="' + key + '"></button>');
        }
        $(document).ready(function($) {
          $(".dial").knob({
            draw: function() {
              var id = this.$[0].id;
              var old = localStorage.getItem(id);
              var value = this.$[0].value;
              localStorage.setItem(id, value);
              socket.emit('changeVariable', [id, value, old])
            }
          });
        });
      }
    })
    socket.on('image', url => {
      $('#screenCast').empty();
      var img = new Image();
      img.id = 'screenShare';
      img.src = url;
      img.height = 300;
      $('#screenCast').get(0).appendChild(img);
    })
  </script>

  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="controller/src/graph.js" charset="utf-8"></script>
  <script src='controller/src/jquery.knob.js' charset="utf-8"></script>
</body>


</html>
